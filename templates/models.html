{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block header_title %}{{ header_title }}{% endblock %}

{% block content %}
    <div class="card">
        <h2>Pull New Model</h2>
        <p> Enter a model name from the <a href="https://ollama.com/search" target="_blank" rel="noopener noreferrer">Ollama Library</a> (e.g., `mistral:latest`).<br>
            Get Models from <a href="https://huggingface.co/models?sort=trending&search=gguf" target="_blank" rel="noopener noreferrer">Hugging Face</a> (e.g., `ollama pull hf.co/janhq/Jan-v1-4B-GGUF:Q4_K_M`).
        </p>
        <div class="form-group">
            <label for="model-name-input">Model Name</label>
            <div class="input-group">
                <input type="text" id="model-name-input" class="input-group-input" placeholder="e.g., gemma:2b">
                <button id="pull-model-btn" class="send-button" title="Pull Model">
                    <span class="material-icons">cloud_download</span>
                </button>
            </div>
        </div>
        <div id="pull-status-container" class="pull-status-container" style="display: none;">
            <pre id="pull-status"></pre>
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2>Local Models</h2>
            <button id="delete-all-models-btn" class="icon-btn" title="Delete All Models" style="color: var(--disconnected); background: rgba(239, 68, 68, 0.1);">
                <span class="material-icons">delete_sweep</span>
                Delete All
            </button>
        </div>
        <p>
            Ollama Status:
            <span class="status-indicator {{ 'connected' if ollama_status == 'Connected' else 'disconnected' }}">
                {{ ollama_status }}
            </span>
        </p>
        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
        <span style="font-weight: 500; font-size: 0.9rem;">De/Activate All Models</span>
        <label class="switch" title="Toggle All Models Active/Inactive">
            <input type="checkbox" id="toggle-all-active">
            <span class="slider round"></span>
        </label>
    </div>
        <table id="local-models-table" class="models-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Size</th>
                    <th>Modified</th>
                    <th style="display: flex; align-items: center; justify-content: space-between;">
                        <span>Active</span>
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Models will be populated by JavaScript -->
            </tbody>
        </table>
        <div id="loading-models" style="text-align: center; padding: 1rem;">Loading...</div>
    </div>
{% endblock %}

{% block page_scripts %}
    <script src="{{ url_for('static', filename='models.js') }}"></script>
    {{ super() }}
{% endblock %}