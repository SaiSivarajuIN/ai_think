{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block header_title %}{{ header_title }}{% endblock %}

{% block head_extra %}
    <!-- Markdown Converter -->
    <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>

    <!-- MathJax v3 for LaTeX rendering -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']], packages: {'[+]': ['ams']}, processEscapes: true },
            options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'] }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" defer></script>
{% endblock %}

{% block header_nav %}
                     <div class="model-selector-wrapper">
                        <label for="model-selector" class="visually-hidden">Model:</label>
                        <select id="model-selector" class="model-selector">
                            {% if available_models %}
                                <optgroup label="Local Models">
                                {% for model in available_models %}
                                    <option value="{{ model }}" {% if model == model_id %}selected{% endif %}>{{ model }}</option>
                                {% endfor %}
                                </optgroup>
                            {% else %}
                                <option value="{{ model_id }}" selected>{{ model_id }} (default)</option>
                            {% endif %}
                            {% if cloud_models %}
                                <optgroup label="Cloud Models">
                                {% for model in cloud_models %}
                                    <option value="cloud::{{ model.id }}">{{ model.service }} / {{ model.model_name }}</option>
                                {% endfor %}
                                </optgroup>
                            {% endif %}
                        </select>
                    </div>
                    <div class="model-selector-wrapper">
                        <label for="prompt-selector" class="visually-hidden">Prompt:</label>
                        <select id="prompt-selector" class="model-selector">
                            <option value="" data-content="">ðŸš€ Select a Prompt...</option>
                            {% for prompt in prompts %}
                                <option value="{{ prompt.id }}" data-content="{{ prompt.content | e }}">
                                    {{ prompt.title }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <button onclick="resetThread()" class="nav-link" title="New Chat">
                        <span class="material-icons">add_comment</span>
                    </button>
                    <button id="search-button" class="nav-link" title="Web Search">
                        <span class="material-icons">search</span>
                    </button>
{% endblock %}

{% block content %}
    <!-- Chat Box -->
    <div id="chatbox" class="page-content" style="padding: 0;"></div>
{% endblock %}

{% block after_content %}
    <!-- Input Area -->
    <div class="input-area-wrapper">
        <div class="input-area">
            <input type="file" id="fileUpload" accept=".txt" title="Upload TXT File" style="display: none;" />
            <button id="uploadButton" class="nav-link" title="Upload TXT File"><span class="material-icons">attach_file</span></button>
            <textarea id="userMessage" placeholder="Type your message..." rows="1"></textarea>
            <button id="sendButton" class="send-button" title="Send"><span class="material-icons">send</span></button>
        </div>
    </div>
{% endblock %}