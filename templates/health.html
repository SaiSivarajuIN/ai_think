{% extends "base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block header_title %}{{ header_title }}{% endblock %}

{% block content %}
    <div class="status-badge {{ status }}">
        System Status: {{ status.title() }}
    </div>

    <div class="dashboard">
        <div class="card">
            <h2>üñ•Ô∏è CPU</h2>
            <p><strong>Cores:</strong> {{ cpu.count }}</p>
            <p><strong>Usage:</strong> {{ cpu.percent }}%</p>
        </div>

        <div class="card">
            <h2>üíæ Memory</h2>
            <p><strong>Total:</strong> {{ memory.total }}</p>
            <p><strong>Available:</strong> {{ memory.available }}</p>
            <p><strong>Used:</strong> {{ memory.used }} ({{ memory.percent }}%)</p>
        </div>

        <div class="card">
            <h2>üíΩ Disk</h2>
            <p><strong>Total:</strong> {{ disk.total }}</p>
            <p><strong>Available:</strong> {{ disk.free }}</p>
            <p><strong>Used:</strong> {{ disk.used }} ({{ disk.percent }}%)</p>
        </div>

        <div class="card">
            <h2>üéÆ GPU</h2>
            {% if gpu_info is string %}
                <p>{{ gpu_info }}</p>
            {% elif gpu_info %}
                {% for gpu in gpu_info %}
                    <div class="gpu-item">
                        <p><strong>ID:</strong> {{ gpu.id }}</p>
                        <p><strong>Name:</strong> {{ gpu.name }}</p>
                        <p><strong>Load:</strong> {{ gpu.load }}</p>
                        <p><strong>Memory:</strong> {{ gpu.memory_used }}/{{ gpu.memory_total }}</p>
                        <p><strong>Temperature:</strong> {{ gpu.temperature }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <p>No GPU detected</p>
            {% endif %}
        </div>

        <div class="card">
            <h2>üóÉÔ∏è Ollama Service</h2>
            <p><strong>Status:</strong>
                <span class="status-indicator {{ 'connected' if ollama_status == 'Connected' else 'disconnected' }}">
                    {{ ollama_status }}
                </span>
            </p>
            <p><strong>Active Model:</strong> <span id="active-model-display">{{ ollama_model }}</span></p>
            <small>This reflects the model selected on the main chat page. The default is shown if no selection has been made.</small>
        </div>
        <div class="card">
            <h2>üìä Langfuse Tracing</h2>
            <p><strong>Status:</strong>
                <span class="status-indicator {{ 'connected' if langfuse_enabled else 'disconnected' }}">
                    {{ 'Enabled' if langfuse_enabled else 'Disabled' }}
                </span>
            </p>
        </div>
        <div class="card">
            <h2>üìÇ ChromaDB</h2>
            <p><strong>Status:</strong>
                <span class="status-indicator {{ 'connected' if chroma_connected else 'disconnected' }}">
                    {{ 'Connected' if chroma_connected else 'Disconnected' }}
                </span>
            </p>
            <small>If connected, chat history is stored in ChromaDB. Otherwise, it falls back to the local SQLite database.</small>
        </div>
        <div class="card">
            <h2>üîç SearXNG</h2>
            <p><strong>Status:</strong>
                <span class="status-indicator {{ 'connected' if searxng_status == 'Connected' else 'disconnected' }}">
                    {{ searxng_status }}
                </span>
            </p>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const modelDisplay = document.getElementById('active-model-display');
            if (modelDisplay) {
                // Retrieve the last selected model from localStorage.
                const storedModel = localStorage.getItem('selectedOllamaModel');
                if (storedModel) {
                    modelDisplay.textContent = storedModel;
                }
            }
        });
    </script>
    {{ super() }}
{% endblock %}